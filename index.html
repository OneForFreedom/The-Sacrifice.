<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>The sacrifice</title>
<style>
  body {margin:0; background:#111; overflow:hidden; color:white; font-family:sans-serif;}
  canvas {display:block; background:#222;}
</style>
</head>
<body>
   <audio id="bgmusic" autoplay loop>
  <source src="SSvid.net--Epic-Dark-Mysterious-Music-Copyright-and-Royalty-Free-Black-Fingerprint_360p.mp4" type="audio/mp4">
</audio>
<canvas id="game"></canvas>
<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

// Make canvas full screen
function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

let keys={};
document.addEventListener("keydown",e=>keys[e.code]=true);
document.addEventListener("keyup",e=>keys[e.code]=false);

let gameStarted=false;
let gameOver=false;
let frame=0;
let score=0;
let spawnRate=40;

let deadLineY = canvas.height - 50;

class Entity {
  constructor(x,y,w,h,color){this.x=x; this.y=y; this.w=w; this.h=h; this.color=color; this.alive=true;}
  draw(){ctx.fillStyle=this.color; ctx.fillRect(this.x,this.y,this.w,this.h);}
}

let player;
let bullets=[];
let enemies=[];
let army={entities:[], ammo:50};
let nuke={active:false,radius:0,max:2500,particles:[]};
let warning={shown:false,active:false,alpha:1,timer:0};

function initGame(){
  deadLineY = canvas.height - 50;
  player=new Entity(canvas.width/2-15,deadLineY-40,30,30,"cyan");
  player.ammo=250;
  bullets=[]; enemies=[]; army.entities=[]; army.ammo=50;
  score=0; frame=0; spawnRate=40; gameOver=false;
  nuke={active:false,radius:0,max:2500,particles:[]};
  warning={shown:false,active:false,alpha:1,timer:0};

  for(let i=0;i<40;i++){
    let x=Math.random()*(canvas.width-15);
    army.entities.push(new Entity(x,player.y-60,10,10,"blue"));
  }
}

function createParticles(x,y,count){
  for(let i=0;i<count;i++){
    nuke.particles.push({x:x,y:y,vx:(Math.random()-0.5)*15,vy:(Math.random()-0.5)*15,alpha:1,size:Math.random()*4+2});
  }
}

function updatePlayer(){
  if(keys["ArrowLeft"] && player.x>0) player.x-=5;
  if(keys["ArrowRight"] && player.x+player.w<canvas.width) player.x+=5;
}

function updateBullets(){
  for(let b of bullets) b.y+=b.vy;
  bullets=bullets.filter(b=>b.y>-10);
}

function updateEnemies(){
  for(let e of enemies){
    e.y+=0.4;
    for(let b of bullets){
      if(b.x>e.x && b.x<e.x+e.w && b.y>e.y && b.y<e.y+e.h){ e.alive=false; score++; }
    }
    if(e.y+e.h>=deadLineY) gameOver=true;
  }
  enemies=enemies.filter(e=>e.alive && e.y<canvas.height);

  if(enemies.length>40 && !warning.shown){
    warning.active=true; warning.shown=true; warning.timer=300; warning.alpha=1;
  }
}

function spawnEnemies(){
  if(frame%spawnRate===0){
    let x=Math.random()*(canvas.width-20);
    enemies.push(new Entity(x,-20,20,20,"red"));
    if(spawnRate>10) spawnRate--;
  }
}

function updateArmy(){for(let a of army.entities){a.x += (Math.random()-0.5)*0.2;}}

function updateNuke(){
  if(nuke.active){
    nuke.radius+=50;
    for(let p of nuke.particles){p.x+=p.vx;p.y+=p.vy;p.alpha-=0.02;}
    nuke.particles=nuke.particles.filter(p=>p.alpha>0);
  }
}

function drawNuke(){
  if(nuke.active){
    ctx.fillStyle="rgba(255,255,255,0.2)";
    ctx.beginPath(); ctx.arc(player.x+player.w/2,player.y+player.h/2,nuke.radius,0,Math.PI*2); ctx.fill();
    for(let p of nuke.particles){ctx.fillStyle=`rgba(255,255,255,${p.alpha})`; ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();}
  }
}

function drawGame(){
  ctx.fillStyle="#222"; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle="white"; ctx.lineWidth=3; ctx.beginPath(); ctx.moveTo(0,deadLineY); ctx.lineTo(canvas.width,deadLineY); ctx.stroke();

  if(player.alive) player.draw();
  ctx.fillStyle="yellow"; bullets.forEach(b=>ctx.fillRect(b.x,b.y,4,8));
  enemies.forEach(e=>e.draw());
  army.entities.forEach(a=>a.draw());
  drawNuke();

  ctx.fillStyle="white"; ctx.font="16px sans-serif";
  ctx.fillText("YOUR Ammo: "+player.ammo,10,20);
  ctx.fillText("Army Ammo: "+army.ammo,10,40);
  ctx.fillText("Score: "+score,10,60);
  ctx.fillText("Enemies: "+enemies.length,10,80);
  ctx.fillText("Press E to self Sacrifice",10,120);
  ctx.fillText("Press R to Restart",10,140);

  if(gameOver && !nuke.active){ctx.font="30px sans-serif"; ctx.fillText("You were overrun. Game Over.",canvas.width/2-200,canvas.height/2);}
  if(gameOver && nuke.active && nuke.particles.length===0){ctx.font="30px sans-serif"; ctx.fillText("You sacrificed everything. The wars won",canvas.width/2-220,canvas.height/2);}

  if(warning.active){ctx.font="24px sans-serif"; ctx.fillStyle=`rgba(255,0,0,${warning.alpha})`; ctx.fillText("We must self sacrifice. Its key to win the war!",canvas.width/5,canvas.height/2); warning.alpha-=1/300; warning.timer--; if(warning.timer<=0) warning.active=false;}
}

function drawOpening(){
  ctx.fillStyle="#111"; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="white"; ctx.font="48px sans-serif"; ctx.fillText("The Sacrifice",canvas.width/4,canvas.height/4);
  ctx.font="24px sans-serif";
  ctx.fillText("Controls:",canvas.width/15,canvas.height/2.5);
  ctx.fillText("F → Player Shoot",canvas.width/15,canvas.height/2.2);
  ctx.fillText("H → Army Shoot",canvas.width/15,canvas.height/2);
  ctx.fillText("E → Ultimate Sacrifice",canvas.width/15,canvas.height/1.8);
  ctx.fillText("R → Restart",canvas.width/15,canvas.height/1.65);
  ctx.fillText("Press ENTER to Start",canvas.width/15,canvas.height/1.5);
}

function loop(){
  if(!gameStarted){
    drawOpening();
    if(keys["Enter"]){gameStarted=true; initGame();}
  } else {
    if(!gameOver){
      if(keys["ArrowLeft"] || keys["ArrowRight"]) updatePlayer();
      if(keys["KeyF"] && player.ammo>0){ bullets.push({x:player.x+player.w/2-2, y:player.y, vx:0, vy:-15}); player.ammo--; }
      if(keys["KeyH"] && army.ammo>0){ army.entities.forEach(a=>bullets.push({x:a.x+a.w/2-2,y:a.y,vx:0,vy:-10})); army.ammo--; }
      updateBullets(); updateEnemies(); spawnEnemies(); updateArmy();
      if(keys["KeyE"] && !nuke.active){ nuke.active=true; nuke.radius=0; createParticles(player.x+player.w/2,player.y+player.h/2,1000); enemies=[]; army.entities=[]; player.alive=false; gameOver=true;}
    }
    if(keys["KeyR"]){ initGame(); }
    updateNuke();
    drawGame();
  }
  frame++; requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
